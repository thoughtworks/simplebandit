<!doctype html>
<html>
  <head>
    <title>Fruit Example</title>
  </head>
  <body>
    <h1>Simple Fruit Bandit</h1>
    <p>
      This is an example of a bandit that is learning the preference among three
      types of fruit (apple, pear or orange) depending on the weather.
    </p>
    <p>
      The weather is either sunny or rainy. The bandit is learning which fruit
      is preferred from eating or not eating, depending on the weather.
    </p>
    <p>
      Decide which fruit you like when and then only eat that fruit when it is
      either raining or sunny. The bandit will learn which fruit you like when
      and will recommend it to you. Then change your mind and see how quickly
      the bandit picks up on your new preference.
    </p>

    <h2>All action probabilities:</h2>
    <div id="action-probabilities"></div>

    <h2>Recommendation JSON:</h2>
    <div id="recommendation-json"></div>

    <h2>Recommended fruit:</h2>
    <div id="recommended-fruit"></div>

    <button id="eat-button">Eat</button>
    <button id="dont-eat-button">Don't eat</button>

    <h2>Training Data</h2>
    <div id="training-data"></div>

    <h2>JSON serialized bandit</h2>
    <div id="serialized-bandit"></div>

    <p><a href="index.html">Back to index</a></p>

    <script src="../../dist/browser/simpleBandit.js"></script>
    <script>
      let bandit = new SimpleBandit({
        oracle: new SimpleOracle({ learningRate: 0.1 }),
        actions: {
          apple: { fruit: 1 },
          pear: { fruit: 1 },
          orange: { fruit: 1 },
          chocolate: { treat: 1 },
          candy: { treat: 1 },
          cake: { treat: 1 },
        },
        temperature: 0.2,
      });
      document.getElementById("serialized-bandit").innerText = bandit.toJSON();

      let recommendation;
      let trainingData = [];
      let context;

      function generateNewRecommendation() {
        recommendation = bandit.recommend();
        document.getElementById("recommended-fruit").innerText =
          recommendation.actionId;
        document.getElementById("recommendation-json").innerText =
          JSON.stringify(recommendation);
        document.getElementById("action-probabilities").innerText =
          JSON.stringify(bandit.getScoredActions());
      }

      generateNewRecommendation();

      document
        .getElementById("eat-button")
        .addEventListener("click", async function () {
          newTrainingData = await bandit.accept(recommendation);
          trainingData = trainingData.concat(newTrainingData);
          document.getElementById("training-data").innerText =
            JSON.stringify(trainingData);
          document.getElementById("serialized-bandit").innerText =
            bandit.toJSON();
          generateNewRecommendation();
        });

      document
        .getElementById("dont-eat-button")
        .addEventListener("click", async function () {
          newTrainingData = await bandit.reject(recommendation);
          trainingData = trainingData.concat(newTrainingData);
          document.getElementById("training-data").innerText =
            JSON.stringify(trainingData);
          document.getElementById("serialized-bandit").innerText =
            bandit.toJSON();
          generateNewRecommendation();
        });
    </script>
  </body>
</html>
