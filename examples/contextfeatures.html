<!doctype html>
<html>
  <head>
    <title>Fruit Example</title>
  </head>
  <body>
    <h1>Simple Fruit Bandit</h1>
    <p>
      This is an example of a bandit that is learning the preference among three
      types of fruit (apple, pear or orange) depending on the weather.
    </p>
    <p>
      The weather is either sunny or rainy. The bandit is learning which fruit
      is preferred from eating or not eating, depending on the weather.
    </p>
    <p>
      Decide which fruit you like when and then only eat that fruit when it is
      either raining or sunny. The bandit will learn which fruit you like when
      and will recommend it to you. Then change your mind and see how quickly
      the bandit picks up on your new preference.
    </p>

    <h2>Learning Rate:</h2>
    <p>
      Higher learning rates mean that the bandit will learn faster, but will
      also forget faster.
    </p>
    <input type="number" id="learning-rate" value="1.0" step="0.1" />

    <h2>Temperature:</h2>
    <p>
      Lower temperature mean that the bandit will be more likely to choose the
      action with the highest score (exploit), higher temperature means that the
      bandit is more likely to choose the actions with a lower score
      (exploration)
    </p>
    <input type="number" id="temperature" value="0.2" step="0.1" />

    <h2>All action probabilities:</h2>
    <div id="action-probabilities"></div>

    <h2>Recommendation JSON:</h2>
    <div id="recommendation-json"></div>

    <h2>Weather:</h2>
    <div id="weather"></div>

    <h2>Recommended fruit:</h2>
    <div id="recommended-fruit"></div>

    <button id="eat-button">Eat</button>
    <button id="dont-eat-button">Don't eat</button>

    <h2>Training Data</h2>
    <div id="training-data"></div>

    <h2>JSON serialized bandit</h2>
    <div id="serialized-bandit"></div>

    <script src="../simpleBandit.js"></script>
    <script>
      let learningRateInput = document.getElementById("learning-rate");
      let temperatureInput = document.getElementById("temperature");
      let learningRate = parseFloat(learningRateInput.value);
      let temperature = parseFloat(temperatureInput.value);

      let bandit = SimpleBandit.fromContextAndActionIds({
        context: ["sunny", "rainy"],
        actionIds: ["apple", "pear", "orange"],
        temperature: temperature,
        learningRate: learningRate,
      });
      document.getElementById("serialized-bandit").innerText = bandit.toJSON();

      let recommendation;
      let trainingData = [];
      let context;

      learningRateInput.addEventListener("change", function () {
        learningRate = parseFloat(learningRateInput.value);
        bandit.oracles[0].learningRate = learningRate;
      });
      temperatureInput.addEventListener("change", function () {
        temperature = parseFloat(temperatureInput.value);
        bandit.temperature = temperature;
        document.getElementById("action-probabilities").innerText =
          JSON.stringify(bandit.getScoredActions(context));
      });

      function generateNewRecommendation() {
        const weather = ["sunny", "rainy"][Math.floor(Math.random() * 2)];
        context =
          weather == "sunny" ? { sunny: 1, rainy: 0 } : { sunny: 0, rainy: 1 };
        recommendation = bandit.recommend(context);

        document.getElementById("weather").innerText = weather;
        document.getElementById("recommended-fruit").innerText =
          recommendation.actionId;
        document.getElementById("recommendation-json").innerText =
          JSON.stringify(recommendation);
        document.getElementById("action-probabilities").innerText =
          JSON.stringify(bandit.getScoredActions(context));
      }

      generateNewRecommendation();

      document
        .getElementById("eat-button")
        .addEventListener("click", async function () {
          newTrainingData = await bandit.accept(recommendation);
          trainingData = trainingData.concat(newTrainingData);
          document.getElementById("training-data").innerText =
            JSON.stringify(trainingData);
          document.getElementById("serialized-bandit").innerText =
            bandit.toJSON();
          generateNewRecommendation();
        });

      document
        .getElementById("dont-eat-button")
        .addEventListener("click", async function () {
          newTrainingData = await bandit.reject(recommendation);
          trainingData = trainingData.concat(newTrainingData);
          document.getElementById("training-data").innerText =
            JSON.stringify(trainingData);
          document.getElementById("serialized-bandit").innerText =
            bandit.toJSON();
          generateNewRecommendation();
        });
    </script>
  </body>
</html>
