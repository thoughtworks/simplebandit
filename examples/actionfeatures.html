<!doctype html>
<html>
  <head>
    <title>Example Page</title>
  </head>
  <body>
    <h1>Fruits vs Treats Bandit</h1>
    <p>
      This is an example of a bandit without context features but with action
      features: We are also learning from similarity in features between
      actions. When you choose a fruit all other fruits become more likely. When
      you choose a treat all other treats become more likely.
    </p>

    <h2>Learning Rate:</h2>
    <p>
      Higher learning rates mean that the bandit will learn faster, but will
      also forget faster.
    </p>
    <input type="number" id="learning-rate" value="1.0" step="0.1" />

    <h2>Temperature:</h2>
    <p>
      Lower temperature mean that the bandit will be more likely to choose
      the action with the highest score (exploit), higher temperature means that
      the bandit is more likely to choose the actions with a lower score (exploration)
    </p>
    <input type="number" id="temperature" value="0.2" step="0.1" />

    <h2>All action probabilities:</h2>
    <div id="action-probabilities"></div>

    <h2>Recommendation JSON:</h2>
    <div id="recommendation-json"></div>

    <h2>Recommended fruit:</h2>
    <div id="recommended-fruit"></div>

    <button id="eat-button">Eat</button>
    <button id="dont-eat-button">Don't eat</button>

    <h2>Training Data</h2>
    <div id="training-data"></div>

    <h2>JSON serialized bandit</h2>
    <div id="serialized-bandit"></div>

    <script src="../simpleBandit.js"></script>
    <script>
      let learningRateInput = document.getElementById("learning-rate");
      let temperatureInput = document.getElementById("temperature");
      let learningRate = parseFloat(learningRateInput.value);
      let temperature = parseFloat(temperatureInput.value);

      const actions = [
        {
          actionId: "apple",
          features: { fruit: 1, treat: 0 },
        },
        {
          actionId: "pear",
          features: { fruit: 1, treat: 0 },
        },
        {
          actionId: "orange",
          features: { fruit: 1, treat: 0 },
        },
        {
          actionId: "chocolate",
          features: { fruit: 0, treat: 1 },
        },
        {
          actionId: "candy",
          features: { fruit: 0, treat: 1 },
        },
        {
          actionId: "cake",
          features: { fruit: 0, treat: 1 },
        },
      ];
      let bandit = SimpleBandit.fromActions({
        actions: actions,
        temperature: temperature,
        learningRate: learningRate,
      });
      let recommendation;
      let recommendedAction;
      let trainingData = [];

      learningRateInput.addEventListener("change", function () {
        learningRate = parseFloat(learningRateInput.value);
        bandit.oracles[0].learningRate = learningRate;
      });
      temperatureInput.addEventListener("change", function () {
        temperature = parseFloat(temperatureInput.value);
        bandit.temperature = temperature;
        document.getElementById("action-probabilities").innerText =
          JSON.stringify(bandit.getScoredActions());
      });

      function generateRecommendation() {
        recommendation = bandit.recommend();
        document.getElementById("recommended-fruit").innerText =
          recommendation.actionId;
        document.getElementById("recommendation-json").innerText =
          JSON.stringify(recommendation);
        document.getElementById("action-probabilities").innerText =
          JSON.stringify(bandit.getScoredActions());
      }

      generateRecommendation();

      document
        .getElementById("eat-button")
        .addEventListener("click", async function () {
          newTrainingData = await bandit.accept(recommendation);
          trainingData = trainingData.concat(newTrainingData);
          document.getElementById("training-data").innerText =
            JSON.stringify(trainingData);
          document.getElementById("serialized-bandit").innerText =
            bandit.toJSON();
          generateRecommendation();
        });

      document
        .getElementById("dont-eat-button")
        .addEventListener("click", async function () {
          newTrainingData = await bandit.reject(recommendation);
          trainingData = trainingData.concat(newTrainingData);
          document.getElementById("training-data").innerText =
            JSON.stringify(trainingData);
          document.getElementById("serialized-bandit").innerText =
            bandit.toJSON();
          generateRecommendation();
        });
    </script>
  </body>
</html>
