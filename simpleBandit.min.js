!function r(a,n,s){function o(e,t){if(!n[e]){if(!a[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(c)return c(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}i=n[e]={exports:{}},a[e][0].call(i.exports,function(t){return o(a[e][1][t]||t)},i,i.exports,r,a,n,s)}return n[e].exports}for(var c="function"==typeof require&&require,t=0;t<s.length;t++)o(s[t]);return o}({1:[function(t,e,i){"use strict";var{SimpleOracle:t,SimpleBandit:r}=t("./src");window.SimpleOracle=t,window.SimpleBandit=r,e.exports={SimpleOracle:t,SimpleBandit:r}},{"./src":5}],2:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SampleFromProbabilityDistribution=void 0;i.SampleFromProbabilityDistribution=t=>{if(0===t.length)throw new Error("probs array must not be empty");if(!t.every(t=>0<=t))throw new Error("probs array must contain only non-negative numbers");if(!t.every(t=>t<=1))throw new Error("probs array must contain numbers between 0 and 1");const e=t.reduce((t,e)=>t+e,0);if(e<=0)throw Error("probs must sum to a value greater than zero");var i=t.map(t=>t/e),r=Math.random();let a=0;for(let t=0;t<i.length;t++)if(r<(a+=i[t]))return t;return-1}},{}],3:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SimpleBandit=void 0;const a=t("./Sampling"),o=t("./SimpleOracle");class c{constructor({oracles:t,actions:e,temperature:i=.5,slateSize:r=1}){this.oracles=Array.isArray(t)?t:[t],this.targetLabels=this.oracles.map(t=>t.targetLabel),this.actionsMap=e.reduce((t,e)=>(t[e.actionId]=e,t),{}),this.temperature=i,this.slateSize=r}static fromActions({actions:t,temperature:e=5,learningRate:i=1,slateSize:r=1}){var a=[...new Set(t.flatMap(t=>Object.keys(t.features)))],n=t.map(t=>t.actionId),n=new o.SimpleOracle({actionIds:n,context:[],actionFeatures:a,learningRate:i});return new c({oracles:[n],actions:t,temperature:e,slateSize:r})}static fromContextAndActions({context:t,actions:e,temperature:i=.5,learningRate:r=1,slateSize:a=1}){var n=[...new Set(e.flatMap(t=>Object.keys(t.features)))],s=e.map(t=>t.actionId),s=new o.SimpleOracle({actionIds:s,context:t,actionFeatures:n,learningRate:r});return new c({oracles:[s],actions:e,temperature:i,slateSize:a})}static fromActionIds({actionIds:t,temperature:e=.5,learningRate:i=1,slateSize:r=1}){t=t.map(t=>({actionId:t,features:{}}));return c.fromActions({actions:t,temperature:e,learningRate:i,slateSize:r})}static fromContextAndActionIds({context:t,actionIds:e,temperature:i=.5,learningRate:r=1,slateSize:a=1}){e=e.map(t=>({actionId:t,features:{}}));return c.fromContextAndActions({context:t,actions:e,temperature:i,learningRate:r,slateSize:a})}toState(){return{oracleStates:this.oracles.map(t=>t.getOracleState()),temperature:this.temperature,slateSize:this.slateSize}}static fromState(t,e){var i=t.oracleStates.map(t=>o.SimpleOracle.fromOracleState(t));return new c({oracles:i,actions:e,temperature:t.temperature,slateSize:t.slateSize})}toJSON(){return JSON.stringify(this.toState())}static fromJSON(t,e){t=JSON.parse(t);return c.fromState(t,e)}_getActionScore(i,r,a){return this.oracles.reduce((t,e)=>t+e.oracleWeight*e.predict(i,r,a),0)}getScoredActions(e={}){let i=[];var r=Object.keys(this.actionsMap);for(let t=0;t<r.length;t++){var a=r[t],n=this.actionsMap[a],n=this._getActionScore(n.actionId,e,n.features),s=Math.exp(n/this.temperature);i.push({actionId:a,score:n,probability:s})}let o=i.reduce((t,e)=>t+e.probability,0);return i=i.map(t=>({actionId:t.actionId,score:t.score,probability:t.probability/o}))}getScoredActionsPerOracle(t={}){var e,i,r=[];for([e,i]of Object.entries(this.actionsMap))for(const n of this.oracles){var a=n.predict(e,t,i.features);r.push({actionId:e,[n.targetLabel]:a,name:n.name,weight:n.oracleWeight})}return r}_generateClickOracleTrainingData(e,i=void 0){if("actionId"in e)return[{actionId:e.actionId,actionFeatures:this.actionsMap[e.actionId].features,context:e.context,click:e.actionId===i?1:0,probability:e.probability}];var r=[];for(let t=0;t<e.slateActions.length;t++){var a=e.slateActions[t].actionId,n=this.actionsMap[a];if(!n)throw new Error(`Failed to generate training data for recommended exercise at index ${t}.`);var s=e.context,o=n.features,n=n.actionId===i?1:0,c=e.slateActions[t].probability;r.push({actionId:a,actionFeatures:o,context:s,click:n,probability:c})}return r}recommend(t={}){var e=this.getScoredActions(t),i=e.map(t=>t.probability),e=e[(0,a.SampleFromProbabilityDistribution)(i)];return{context:t,actionId:e.actionId,score:e.score,probability:e.probability}}slate(t={}){var e=this.getScoredActions(t),i=[];for(let t=0;t<this.slateSize;t++){var r=e.map(t=>t.probability),r=(0,a.SampleFromProbabilityDistribution)(r);i[t]=e[r],e.splice(r,1)}return{context:t,slateActions:i}}accept(r){return new Promise((t,e)=>{try{if(!this.targetLabels.includes("click"))throw new Error("no oracle with `click` as targetLabel, so cannot use accept()");var i=this._generateClickOracleTrainingData(r,r.actionId);this.train(i),t(i)}catch(t){e(t)}})}choose(r,a){return new Promise((t,e)=>{try{if(!this.targetLabels.includes("click"))throw new Error("no oracle with `click` as targetLabel, so cannot use accept()");if(null==a)throw new Error("need to provide actionId");if(!r.slateActions.map(t=>t.actionId).includes(a))throw new Error(`ActionId ${a} is not in slateActions`);var i=this._generateClickOracleTrainingData(r,a);this.train(i),t(i)}catch(t){e(t)}})}reject(r){return new Promise((t,e)=>{try{if(!this.targetLabels.includes("click"))throw new Error("no oracle with `click` as targetLabel, so cannot use accept()");var i=this._generateClickOracleTrainingData(r,void 0);this.train(i),t(i)}catch(t){e(t)}})}feedback(n,s,o,c=void 0){return new Promise((i,e)=>{try{if(!this.targetLabels.includes(s))throw new Error(`label ${s} not in any of weightedOracles`);let t,e;if("actionId"in n){if(c&&c!==n.actionId)throw new Error(`actionId ${c} does not match recommendation.actionId `+n.actionId);t=this.actionsMap[n.actionId],e=n.probability}else{if(void 0===c)throw new Error("actionId must be provided for slate");var r=n.slateActions.find(t=>t.actionId===c);if(!r)throw new Error("No action found in slate with actionId "+c);if(!this.actionsMap.hasOwnProperty(c))throw new Error("No action found for this bandit with actionId "+c);t=this.actionsMap[c],e=r.probability}var a=[{actionId:t.actionId,actionFeatures:t.features,context:n.context,[s]:o,probability:e}];this.train(a),i(a)}catch(t){e(t)}})}train(r){return new Promise((t,e)=>{try{for(var i of this.oracles)i.fitMany(r);t()}catch(t){e(t)}})}}i.SimpleBandit=c},{"./Sampling":2,"./SimpleOracle":4}],4:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SimpleOracle=void 0;class r{constructor({actionIds:t=[],context:e=[],actionFeatures:i=[],learningRate:r=.5,contextActionIdInteractions:a=!0,contextActionFeatureInteractions:n=!0,useInversePropensityWeighting:s=!0,negativeClassWeight:o=1,targetLabel:c="click",strictFeatures:l=!0,name:h="click",oracleWeight:u=1,weights:d={}}={}){if(!Array.isArray(t)||!Array.isArray(e)||!Array.isArray(i))throw new Error("actionIds, context, actionFeatures must be arrays.");if("number"!=typeof r||r<=0)throw new Error("Invalid argument: learningRate must be a positive number.");if("boolean"!=typeof a||"boolean"!=typeof n||"boolean"!=typeof s||"boolean"!=typeof l)throw new Error("contextActionIdInteractions, contextActionFeatureInteractions, useInversePropensityWeighting, strictFeatures must be booleans.");this.addIntercept=!0,this.setFeaturesAndUpdateWeights(t,e,i,a,n,d),this.targetLabel=c,this.learningRate=r,this.useInversePropensityWeighting=s,this.negativeClassWeight=o,this.strictFeatures=l,this.name=h,this.oracleWeight=u}getOracleState(){return{actionIds:this.actionIds,context:this.context,actionFeatures:this.actionFeatures,learningRate:this.learningRate,contextActionIdInteractions:this.contextActionIdInteractions,contextActionFeatureInteractions:this.contextActionFeatureInteractions,useInversePropensityWeighting:this.useInversePropensityWeighting,negativeClassWeight:this.negativeClassWeight,targetLabel:this.targetLabel,strictFeatures:this.strictFeatures,name:this.name,oracleWeight:this.oracleWeight,weights:this.getWeightsHash()}}static fromOracleState(t){return new r({actionIds:t.actionIds,context:t.context,actionFeatures:t.actionFeatures,learningRate:t.learningRate,contextActionIdInteractions:t.contextActionIdInteractions,contextActionFeatureInteractions:t.contextActionFeatureInteractions,useInversePropensityWeighting:t.useInversePropensityWeighting,negativeClassWeight:t.negativeClassWeight,targetLabel:t.targetLabel,strictFeatures:t.strictFeatures,name:t.name,oracleWeight:t.oracleWeight,weights:t.weights})}toJSON(){return JSON.stringify(this.getOracleState())}static fromJSON(t){t=JSON.parse(t);return r.fromOracleState(t)}_getFeatures(){return[...this.actionIds,...this.actionFeatures,...this.interactionFeatures]}_getInteractionFeatures(){var i=[];if(this.contextActionIdInteractions)for(let e=0;e<this.context.length;e++)for(let t=0;t<this.actionIds.length;t++)i.push(this.context[e]+"*"+this.actionIds[t]);if(this.contextActionFeatureInteractions)for(let e=0;e<this.context.length;e++)for(let t=0;t<this.actionFeatures.length;t++)i.push(this.context[e]+"*"+this.actionFeatures[t]);return i}_getNFeatures(){return this.addIntercept?this.features.length+1:this.features.length}_zeroWeights(t){return Array(t).fill(0)}_updateWeights(t={}){var e=Object.assign({},this.getWeightsHash(),t),i=(this.weights=this._zeroWeights(this._getNFeatures()),this.addIntercept?1:0);this.addIntercept&&(this.weights[0]=null!=(t=e.intercept)?t:this.weights[0]);for(let t=0;t<this.features.length;t++){var r=this.features[t];this.weights[t+i]=null!=(r=e[r])?r:this.weights[t+i]}return this.weights}setFeaturesAndUpdateWeights(t,e,i,r,a,n={}){this.actionIds=null!=t?t:this.actionIds,this.context=null!=e?e:this.context,this.actionFeatures=null!=i?i:this.actionFeatures,this.contextActionIdInteractions=null!=r?r:this.contextActionIdInteractions,this.contextActionFeatureInteractions=null!=a?a:this.contextActionFeatureInteractions,this.allInputFeatures=[...this.context,...this.actionFeatures],this.interactionFeatures=this._getInteractionFeatures(),this.features=this._getFeatures(),this.nFeatures=this._getNFeatures(),this.weights=this._updateWeights(n)}getWeightsHash(){let i={};return null!=this.weights&&(this.addIntercept&&(i.intercept=this.weights[0]),void 0!==this.features)&&this.features.forEach((t,e)=>{i[t]=this.weights[e+1]}),i}getWeightsMap(i=3){const r=new Map;return this.addIntercept?(r.set("intercept",Number(this.weights[0]).toFixed(i)),this.features.forEach((t,e)=>{r.set(t,Number(this.weights[e+1]).toFixed(i))})):this.features.forEach((t,e)=>{r.set(t,Number(this.weights[e]).toFixed(i))}),r}_hashContainsAllKeys(e,i){for(let t=0;t<i.length;t++)if(!e.hasOwnProperty(i[t]))return!1;return!0}_addActionIdFeatures(e,i=void 0){for(let t=0;t<this.actionIds.length;t++)this.actionIds[t]===i?e[this.actionIds[t]]=1:e[this.actionIds[t]]=0;return e}_addInteractionFeatures(i){if(this.contextActionIdInteractions)for(let e=0;e<this.context.length;e++)for(let t=0;t<this.actionIds.length;t++)i[this.context[e]+"*"+this.actionIds[t]]=i[this.context[e]]*i[this.actionIds[t]];if(this.contextActionFeatureInteractions)for(let e=0;e<this.context.length;e++)for(let t=0;t<this.actionFeatures.length;t++)i[this.context[e]+"*"+this.actionFeatures[t]]=i[this.context[e]]*i[this.actionFeatures[t]];return i}_getOrderedInputsArray(t,e={},i={}){let r=Object.assign(Object.assign({},e),i);if(!this._hashContainsAllKeys(r,this.allInputFeatures)){const n=[];if(this.allInputFeatures.forEach(t=>{r.hasOwnProperty(t)||n.push(t)}),this.strictFeatures)throw new Error("Missing features in inputsHash: "+n);n.forEach(t=>{r[t]=0})}r=this._addActionIdFeatures(r,t),r=this._addInteractionFeatures(r);var a=[];this.addIntercept&&a.push(1);for(const s of this.features)a.push(r[s]);return a}_sigmoid(t){return 1/(1+Math.exp(-t))}_predictLogit(t,e={},i={}){var r=this._getOrderedInputsArray(t,e,i);let a=0;for(let t=0;t<r.length;t++)a+=r[t]*this.weights[t];return a}predict(t,e={},i={}){t=this._predictLogit(t,e,i);return this._sigmoid(t)}fit(t){var i;if(void 0!==t[this.targetLabel]){var r=this._getOrderedInputsArray(t.actionId,null!=(i=t.context)?i:{},null!=(i=t.actionFeatures)?i:{}),a=t[this.targetLabel];let e=1;this.useInversePropensityWeighting&&(e=1/(null!=(i=t.probability)?i:.1)),0==a&&(e*=this.negativeClassWeight);var n=this._sigmoid(this._predictLogit(t.actionId,t.context,t.actionFeatures));for(let t=0;t<this.weights.length;t++){var s=e*this.learningRate*((n-a)*r[t]);this.weights[t]-=s}}}fitMany(e){for(let t=0;t<e.length;t++)this.fit(e[t])}}i.SimpleOracle=r},{}],5:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var a=Object.getOwnPropertyDescriptor(e,i);a&&("get"in a?e.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,a)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),a=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),a(t("./interfaces"),i),a(t("./SimpleOracle"),i),a(t("./SimpleBandit"),i)},{"./SimpleBandit":3,"./SimpleOracle":4,"./interfaces":12}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],7:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],8:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],9:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],10:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],11:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],12:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var a=Object.getOwnPropertyDescriptor(e,i);a&&("get"in a?e.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,a)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),a=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),a(t("./IAction"),i),a(t("./IRecommendation"),i),a(t("./ISimpleBandit"),i),a(t("./ISimpleOracle"),i),a(t("./IState"),i),a(t("./ITrainingData"),i)},{"./IAction":6,"./IRecommendation":7,"./ISimpleBandit":8,"./ISimpleOracle":9,"./IState":10,"./ITrainingData":11}]},{},[1]);