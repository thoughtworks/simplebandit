!function r(n,a,o){function s(e,t){if(!a[e]){if(!n[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(c)return c(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}i=a[e]={exports:{}},n[e][0].call(i.exports,function(t){return s(n[e][1][t]||t)},i,i.exports,r,n,a,o)}return a[e].exports}for(var c="function"==typeof require&&require,t=0;t<o.length;t++)s(o[t]);return s}({1:[function(t,e,i){"use strict";var{SimpleOracle:t,SimpleBandit:r}=t("./src");window.SimpleOracle=t,window.SimpleBandit=r,e.exports={SimpleOracle:t,SimpleBandit:r}},{"./src":5}],2:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SampleFromProbabilityDistribution=void 0;i.SampleFromProbabilityDistribution=t=>{if(0===t.length)throw new Error("probs array must not be empty");if(!t.every(t=>0<=t))throw new Error("probs array must contain only non-negative numbers");if(!t.every(t=>t<=1))throw new Error("probs array must contain numbers between 0 and 1");const e=t.reduce((t,e)=>t+e,0);if(e<=0)throw Error("probs must sum to a value greater than zero");var i=t.map(t=>t/e),r=Math.random();let n=0;for(let t=0;t<i.length;t++)if(r<(n+=i[t]))return t;return-1}},{}],3:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SimpleBandit=void 0;const n=t("./Sampling"),s=t("./SimpleOracle");class c{constructor({oracles:t,actions:e,temperature:i=.5,slateSize:r=1}){this.oracles=Array.isArray(t)?t:[t],this.targetLabels=this.oracles.map(t=>t.targetLabel),this.actionsMap=e.reduce((t,e)=>(t[e.actionId]=e,t),{}),this.temperature=i,this.slateSize=r}static fromActions({actions:t,temperature:e=5,learningRate:i=1,slateSize:r=1}){var n=[...new Set(t.flatMap(t=>Object.keys(t.features)))],a=t.map(t=>t.actionId),a=new s.SimpleOracle({actionIds:a,context:[],features:n,learningRate:i});return new c({oracles:[a],actions:t,temperature:e,slateSize:r})}static fromContextAndActions({context:t,actions:e,temperature:i=.5,learningRate:r=1,slateSize:n=1}){var a=[...new Set(e.flatMap(t=>Object.keys(t.features)))],o=e.map(t=>t.actionId),o=new s.SimpleOracle({actionIds:o,context:t,features:a,learningRate:r});return new c({oracles:[o],actions:e,temperature:i,slateSize:n})}static fromActionIds({actionIds:t,temperature:e=.5,learningRate:i=1,slateSize:r=1}){t=t.map(t=>({actionId:t,features:{}}));return c.fromActions({actions:t,temperature:e,learningRate:i,slateSize:r})}static fromContextAndActionIds({context:t,actionIds:e,temperature:i=.5,learningRate:r=1,slateSize:n=1}){e=e.map(t=>({actionId:t,features:{}}));return c.fromContextAndActions({context:t,actions:e,temperature:i,learningRate:r,slateSize:n})}toState(){return{oracleStates:this.oracles.map(t=>t.getOracleState()),temperature:this.temperature,slateSize:this.slateSize}}static fromState(t,e){var i=t.oracleStates.map(t=>s.SimpleOracle.fromOracleState(t));return new c({oracles:i,actions:e,temperature:t.temperature,slateSize:t.slateSize})}toJSON(){return JSON.stringify(this.toState())}static fromJSON(t,e){t=JSON.parse(t);return c.fromState(t,e)}_getActionScore(i,r,n){return this.oracles.reduce((t,e)=>t+e.oracleWeight*e.predict(i,r,n),0)}getScoredActions(e={}){let i=[];var r=Object.keys(this.actionsMap);for(let t=0;t<r.length;t++){var n=r[t],a=this.actionsMap[n],a=this._getActionScore(a.actionId,e,a.features),o=Math.exp(a/this.temperature);i.push({actionId:n,score:a,probability:o})}let s=i.reduce((t,e)=>t+e.probability,0);return i=i.map(t=>({actionId:t.actionId,score:t.score,probability:t.probability/s}))}getScoredActionsPerOracle(t={}){var e,i,r=[];for([e,i]of Object.entries(this.actionsMap))for(const a of this.oracles){var n=a.predict(e,t,i.features);r.push({actionId:e,[a.targetLabel]:n,name:a.name,weight:a.oracleWeight})}return r}_generateClickOracleTrainingData(e,i=void 0){if("actionId"in e)return[{actionId:e.actionId,features:this.actionsMap[e.actionId].features,context:e.context,click:e.actionId===i?1:0,probability:e.probability}];var r=[];for(let t=0;t<e.slateActions.length;t++){var n=e.slateActions[t].actionId,a=this.actionsMap[n];if(!a)throw new Error(`Failed to generate training data for recommended exercise at index ${t}.`);var o=e.context,s=a.features,a=a.actionId===i?1:0,c=e.slateActions[t].probability;r.push({actionId:n,features:s,context:o,click:a,probability:c})}return r}recommend(t={}){var e=this.getScoredActions(t),i=e.map(t=>t.probability),e=e[(0,n.SampleFromProbabilityDistribution)(i)];return{context:t,actionId:e.actionId,score:e.score,probability:e.probability}}slate(t={}){var e=this.getScoredActions(t),i=[];for(let t=0;t<this.slateSize;t++){var r=e.map(t=>t.probability),r=(0,n.SampleFromProbabilityDistribution)(r);i[t]=e[r],e.splice(r,1)}return{context:t,slateActions:i}}accept(r){return new Promise((t,e)=>{try{if(!this.targetLabels.includes("click"))throw new Error("no oracle with `click` as targetLabel, so cannot use accept()");var i=this._generateClickOracleTrainingData(r,r.actionId);this.train(i),t(i)}catch(t){e(t)}})}choose(r,n){return new Promise((t,e)=>{try{if(!this.targetLabels.includes("click"))throw new Error("no oracle with `click` as targetLabel, so cannot use accept()");if(null==n)throw new Error("need to provide actionId");if(!r.slateActions.map(t=>t.actionId).includes(n))throw new Error(`ActionId ${n} is not in slateActions`);var i=this._generateClickOracleTrainingData(r,n);this.train(i),t(i)}catch(t){e(t)}})}reject(r){return new Promise((t,e)=>{try{if(!this.targetLabels.includes("click"))throw new Error("no oracle with `click` as targetLabel, so cannot use accept()");var i=this._generateClickOracleTrainingData(r,void 0);this.train(i),t(i)}catch(t){e(t)}})}feedback(a,o,s,c=void 0){return new Promise((i,e)=>{try{if(!this.targetLabels.includes(o))throw new Error(`label ${o} not in any of weightedOracles`);let t,e;if("actionId"in a){if(c&&c!==a.actionId)throw new Error(`actionId ${c} does not match recommendation.actionId `+a.actionId);t=this.actionsMap[a.actionId],e=a.probability}else{if(void 0===c)throw new Error("actionId must be provided for slate");var r=a.slateActions.find(t=>t.actionId===c);if(!r)throw new Error("No action found in slate with actionId "+c);if(!this.actionsMap.hasOwnProperty(c))throw new Error("No action found for this bandit with actionId "+c);t=this.actionsMap[c],e=r.probability}var n=[{actionId:t.actionId,features:t.features,context:a.context,[o]:s,probability:e}];this.train(n),i(n)}catch(t){e(t)}})}train(r){return new Promise((t,e)=>{try{for(var i of this.oracles)i.fit(r);t()}catch(t){e(t)}})}}i.SimpleBandit=c},{"./Sampling":2,"./SimpleOracle":4}],4:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SimpleOracle=void 0;class r{constructor({actionIds:t=void 0,context:e=void 0,features:i=void 0,learningRate:r=.5,actionIdFeatures:n=!0,contextActionIdInteractions:a=!0,contextActionFeatureInteractions:o=!0,useInversePropensityWeighting:s=!0,targetLabel:c="click",name:l="click",oracleWeight:u=1,weights:d={}}={}){if(!((void 0===t||Array.isArray(t)&&t.every(t=>"string"==typeof t))&&(void 0===e||Array.isArray(e)&&e.every(t=>"string"==typeof t))&&(void 0===i||Array.isArray(i)&&i.every(t=>"string"==typeof t))))throw new Error("actionIds, context, features must be arrays of strings or undefined.");if("number"!=typeof r||r<=0)throw new Error("Invalid argument: learningRate must be a positive number.");if("boolean"!=typeof n||"boolean"!=typeof a||"boolean"!=typeof o||"boolean"!=typeof s)throw new Error("actionIdFeatures, contextActionIdInteractions, contextActionFeatureInteractions, useInversePropensityWeighting must be booleans.");this.actionIds=t,this.context=e,this.features=i,this.addIntercept=!0,this.actionIdFeatures=n,this.contextActionIdInteractions=a,this.contextActionFeatureInteractions=o,this.targetLabel=c,this.learningRate=r,this.useInversePropensityWeighting=s,this.name=l,this.oracleWeight=u,this.weights=d}getOracleState(){return{actionIds:this.actionIds,context:this.context,features:this.features,learningRate:this.learningRate,actionIdFeatures:this.actionIdFeatures,contextActionIdInteractions:this.contextActionIdInteractions,contextActionFeatureInteractions:this.contextActionFeatureInteractions,useInversePropensityWeighting:this.useInversePropensityWeighting,targetLabel:this.targetLabel,name:this.name,oracleWeight:this.oracleWeight,weights:this.weights}}static fromOracleState(t){return new r({actionIds:t.actionIds,context:t.context,features:t.features,learningRate:t.learningRate,actionIdFeatures:t.actionIdFeatures,contextActionIdInteractions:t.contextActionIdInteractions,contextActionFeatureInteractions:t.contextActionFeatureInteractions,useInversePropensityWeighting:t.useInversePropensityWeighting,targetLabel:t.targetLabel,name:t.name,oracleWeight:t.oracleWeight,weights:t.weights})}toJSON(){return JSON.stringify(this.getOracleState())}static fromJSON(t){t=JSON.parse(t);return r.fromOracleState(t)}_sigmoid(t){return 1/(1+Math.exp(-t))}_getModelInputsWeightsAndLogit(t,e={},i={}){var r,n,a={},o={};let s=0;if(this.addIntercept&&(o.intercept=this.weights.intercept||0,a.intercept=1,s+=o.intercept*a.intercept),this.actionIdFeatures&&(o[t]=this.weights[t]||0,a[t]=1,s+=a[t]*o[t]),this.contextActionIdInteractions)for(var c in e)this.context&&!this.context.includes(c)||(o[r=c+"*"+t]=this.weights[r]||0,a[r]=e[c],s+=o[r]*a[r]);if(this.contextActionFeatureInteractions)for(var l in i)if(!this.features||this.features.includes(l))for(var u in e)this.context&&!this.context.includes(u)||(o[n=u+"*"+l]=this.weights[n]||0,a[n]=e[u]*i[l],s+=o[n]*a[n]);return{inputs:a,weights:o,logit:s}}predict(t,e={},i={}){t=this._getModelInputsWeightsAndLogit(t,e,i);return this._sigmoid(t.logit)}fit(t){var e;for(e of t=Array.isArray(t)?t:[t])if(void 0!==e[this.targetLabel]){var i=this._getModelInputsWeightsAndLogit(e.actionId,null!=(r=e.context)?r:{},null!=(r=e.features)?r:{}),r=e[this.targetLabel];let t=1;this.useInversePropensityWeighting&&(t=1/(null!=(a=e.probability)?a:.1));var n,a=this._sigmoid(i.logit),o=t*this.learningRate*(a-r);for(n in i.inputs)this.weights[n]=i.weights[n]-o*i.inputs[n]}}}i.SimpleOracle=r},{}],5:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&("get"in n?e.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,n)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(t("./interfaces"),i),n(t("./SimpleOracle"),i),n(t("./SimpleBandit"),i)},{"./SimpleBandit":3,"./SimpleOracle":4,"./interfaces":12}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],7:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],8:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],9:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],10:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],11:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],12:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&("get"in n?e.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,n)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(t("./IAction"),i),n(t("./IRecommendation"),i),n(t("./ISimpleBandit"),i),n(t("./ISimpleOracle"),i),n(t("./IState"),i),n(t("./ITrainingData"),i)},{"./IAction":6,"./IRecommendation":7,"./ISimpleBandit":8,"./ISimpleOracle":9,"./IState":10,"./ITrainingData":11}]},{},[1]);