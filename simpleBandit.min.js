!function r(n,a,o){function s(e,t){if(!a[e]){if(!n[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(c)return c(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}i=a[e]={exports:{}},n[e][0].call(i.exports,function(t){return s(n[e][1][t]||t)},i,i.exports,r,n,a,o)}return a[e].exports}for(var c="function"==typeof require&&require,t=0;t<o.length;t++)s(o[t]);return s}({1:[function(t,e,i){"use strict";var{SimpleOracle:t,SimpleBandit:r}=t("./src");window.SimpleOracle=t,window.SimpleBandit=r,e.exports={SimpleOracle:t,SimpleBandit:r}},{"./src":5}],2:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SampleFromProbabilityDistribution=void 0;i.SampleFromProbabilityDistribution=t=>{if(0===t.length)throw new Error("probs array must not be empty");if(!t.every(t=>0<=t))throw new Error("probs array must contain only non-negative numbers");if(!t.every(t=>t<=1))throw new Error("probs array must contain numbers between 0 and 1");const e=t.reduce((t,e)=>t+e,0);if(e<=0)throw Error("probs must sum to a value greater than zero");var i=t.map(t=>t/e),r=Math.random();let n=0;for(let t=0;t<i.length;t++)if(r<(n+=i[t]))return t;return-1}},{}],3:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SimpleBandit=void 0;const a=t("./Sampling"),n=t("./SimpleOracle");class r{constructor({oracle:t,actions:e,temperature:i=.5,slateSize:r=1}){this.oracle=Array.isArray(t)?t:t?[t]:[new n.SimpleOracle],this.targetLabels=[...new Set(this.oracle.map(t=>t.targetLabel))],this.actionsMap=this._processActions(e),this.temperature=i,this.slateSize=r}_processActions(i){const r={};return Array.isArray(i)?i.forEach(t=>{"string"==typeof t?r[t]={actionId:t,features:{}}:r[t.actionId]=t}):Object.keys(i).forEach(t=>{var e=i[t];Array.isArray(e)?r[t]={actionId:t,features:e.reduce((t,e)=>(t[e]=1,t),{})}:r[t]={actionId:t,features:e}}),r}toState(){return{oracleStates:this.oracle.map(t=>t.getOracleState()),temperature:this.temperature,slateSize:this.slateSize}}static fromState(t,e){var i=t.oracleStates.map(t=>n.SimpleOracle.fromOracleState(t));return new r({oracle:i,actions:e,temperature:t.temperature,slateSize:t.slateSize})}toJSON(){return JSON.stringify(this.toState())}static fromJSON(t,e){t=JSON.parse(t);return r.fromState(t,e)}_getActionScore(i,r,n){return this.oracle.reduce((t,e)=>t+e.oracleWeight*e.predict(i,r,n),0)}getScoredActions(e={},i={}){let r=[],n=Object.keys(this.actionsMap);null!=i&&i.include&&(n=n.filter(t=>{var e;return null==(e=null==i?void 0:i.include)?void 0:e.includes(t)})),null!=i&&i.exclude&&(n=n.filter(t=>{var e;return!(null!=(e=null==i?void 0:i.exclude)&&e.includes(t))}));for(let t=0;t<n.length;t++){var a=n[t],o=this.actionsMap[a],o=this._getActionScore(o.actionId,e,o.features),s=Math.exp(o/this.temperature);r.push({actionId:a,score:o,probability:s})}const c=r.reduce((t,e)=>t+e.probability,0);return r=r.map(t=>({actionId:t.actionId,score:t.score,probability:t.probability/c}))}getScoredActionsPerOracle(t={},e={}){var i,r=[];for(i of this.getScoredActions(t,e)){var n,a={actionId:i.actionId,weightedScore:i.score,probability:i.probability};for(n of this.oracle){var o=n.predict(i.actionId,t,this.actionsMap[i.actionId].features);a[n.name]=o}r.push(a)}return r}_generateClickOracleTrainingData(e,i=void 0){if("actionId"in e)return[{recommendationId:e.recommendationId,actionId:e.actionId,features:this.actionsMap[e.actionId].features,context:e.context,click:e.actionId===i?1:0,probability:e.probability}];var r=[];for(let t=0;t<e.slateItems.length;t++){var n=e.slateItems[t].actionId,a=this.actionsMap[n];if(!a)throw new Error(`Failed to generate training data for recommended exercise at index ${t}.`);var o=e.context,s=a.features,a=a.actionId===i?1:0,c=e.slateItems[t].probability;r.push({recommendationId:e.recommendationId,actionId:n,features:s,context:o,click:a,probability:c})}return r}_generateRecommendationId(){return"id-"+Math.random().toString(36).substr(2,16)+"-"+Date.now().toString(36)}recommend(t={},e={}){var e=this.getScoredActions(t,e),i=e.map(t=>t.probability),e=e[(0,a.SampleFromProbabilityDistribution)(i)];return{recommendationId:this._generateRecommendationId(),context:t,actionId:e.actionId,score:e.score,probability:e.probability}}slate(t={},e={}){var i=this.getScoredActions(t,e),r=[];for(let t=0;t<this.slateSize;t++){var n=i.map(t=>t.probability),n=(0,a.SampleFromProbabilityDistribution)(n);r[t]=i[n],i.splice(n,1)}return{recommendationId:this._generateRecommendationId(),context:t,slateItems:r}}accept(r){return new Promise((t,e)=>{try{if(!this.targetLabels.includes("click"))throw new Error("no oracle with `click` as targetLabel, so cannot use accept()");var i=this._generateClickOracleTrainingData(r,r.actionId);this.train(i),t(i)}catch(t){e(t)}})}choose(r,n){return new Promise((t,e)=>{try{if(!this.targetLabels.includes("click"))throw new Error("no oracle with `click` as targetLabel, so cannot use accept()");if(null==n)throw new Error("need to provide actionId");if(!r.slateItems.map(t=>t.actionId).includes(n))throw new Error(`ActionId ${n} is not in slateItems`);var i=this._generateClickOracleTrainingData(r,n);this.train(i),t(i)}catch(t){e(t)}})}reject(r){return new Promise((t,e)=>{try{if(!this.targetLabels.includes("click"))throw new Error("no oracle with `click` as targetLabel, so cannot use accept()");var i=this._generateClickOracleTrainingData(r,void 0);this.train(i),t(i)}catch(t){e(t)}})}feedback(a,o,s,c=void 0){return new Promise((i,e)=>{try{if(!this.targetLabels.includes(o))throw new Error(`label ${o} not in any of weightedOracles`);let t,e;if("actionId"in a){if(c&&c!==a.actionId)throw new Error(`actionId ${c} does not match recommendation.actionId `+a.actionId);t=this.actionsMap[a.actionId],e=a.probability}else{if(void 0===c)throw new Error("actionId must be provided for slate");var r=a.slateItems.find(t=>t.actionId===c);if(!r)throw new Error("No action found in slate with actionId "+c);if(!this.actionsMap.hasOwnProperty(c))throw new Error("No action found for this bandit with actionId "+c);t=this.actionsMap[c],e=r.probability}var n=[{recommendationId:a.recommendationId,actionId:t.actionId,features:t.features,context:a.context,[o]:s,probability:e}];this.train(n),i(n)}catch(t){e(t)}})}train(r){return new Promise((t,e)=>{try{for(const i of this.oracle)i.fit(r);t()}catch(t){e(t)}})}}i.SimpleBandit=r},{"./Sampling":2,"./SimpleOracle":4}],4:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SimpleOracle=void 0;class r{constructor({actionIds:t=void 0,context:e=void 0,features:i=void 0,learningRate:r=.1,actionIdFeatures:n=!0,actionFeatures:a=!0,contextActionIdInteractions:o=!0,contextActionFeatureInteractions:s=!0,useInversePropensityWeighting:c=!0,targetLabel:l="click",name:u=void 0,oracleWeight:d=1,weights:h={}}={}){if(!((void 0===t||Array.isArray(t)&&t.every(t=>"string"==typeof t))&&(void 0===e||Array.isArray(e)&&e.every(t=>"string"==typeof t))&&(void 0===i||Array.isArray(i)&&i.every(t=>"string"==typeof t))))throw new Error("actionIds, context, features must be arrays of strings or undefined.");if("number"!=typeof r||r<=0)throw new Error("Invalid argument: learningRate must be a positive number.");if("boolean"!=typeof n||"boolean"!=typeof a||"boolean"!=typeof o||"boolean"!=typeof s||"boolean"!=typeof c)throw new Error("actionIdFeatures, actionFeatures, contextActionIdInteractions, contextActionFeatureInteractions, useInversePropensityWeighting must be booleans.");this.actionIds=t,this.context=e,this.features=i,this.addIntercept=!0,this.actionIdFeatures=n,this.actionFeatures=a,this.contextActionIdInteractions=o,this.contextActionFeatureInteractions=s,this.targetLabel=l,this.learningRate=r,this.useInversePropensityWeighting=c,this.name=u||l,this.oracleWeight=d,this.weights=h}getOracleState(){return{actionIds:this.actionIds,context:this.context,features:this.features,learningRate:this.learningRate,actionIdFeatures:this.actionIdFeatures,actionFeatures:this.actionFeatures,contextActionIdInteractions:this.contextActionIdInteractions,contextActionFeatureInteractions:this.contextActionFeatureInteractions,useInversePropensityWeighting:this.useInversePropensityWeighting,targetLabel:this.targetLabel,name:this.name,oracleWeight:this.oracleWeight,weights:this.weights}}static fromOracleState(t){return new r({actionIds:t.actionIds,context:t.context,features:t.features,learningRate:t.learningRate,actionIdFeatures:t.actionIdFeatures,actionFeatures:t.actionFeatures,contextActionIdInteractions:t.contextActionIdInteractions,contextActionFeatureInteractions:t.contextActionFeatureInteractions,useInversePropensityWeighting:t.useInversePropensityWeighting,targetLabel:t.targetLabel,name:t.name,oracleWeight:t.oracleWeight,weights:t.weights})}toJSON(){return JSON.stringify(this.getOracleState())}static fromJSON(t){t=JSON.parse(t);return r.fromOracleState(t)}_sigmoid(t){return 1/(1+Math.exp(-t))}_getModelInputsWeightsAndLogit(t,e={},i={}){var r,n={},a={};let o=0;if(this.addIntercept&&(a.intercept=this.weights.intercept||0,n.intercept=1,o+=a.intercept*n.intercept),this.actionIdFeatures&&(a[t]=this.weights[t]||0,n[t]=1,o+=n[t]*a[t]),this.actionFeatures)for(const c in i)if(!this.features||this.features.includes(c)){if(1<i[c]||i[c]<-1)throw new Error("Feature values must be between -1 and 1! But got features=`${features}`");a[c]=this.weights[c]||0,n[c]=i[c],o+=a[c]*n[c]}if(this.contextActionIdInteractions)for(const l in e)this.context&&!this.context.includes(l)||(a[r=l+"*"+t]=this.weights[r]||0,n[r]=e[l],o+=a[r]*n[r]);if(this.contextActionFeatureInteractions)for(const u in i)if(!this.features||this.features.includes(u))for(const d in e)if(!this.context||this.context.includes(d)){if(1<e[d]||e[d]<-1||1<i[u]||i[u]<-1)throw new Error("Context and feature values must be between -1 and 1! But got context=`${context}` and features=`${features}`");var s=d+"*"+u;a[s]=this.weights[s]||0,n[s]=e[d]*i[u],o+=a[s]*n[s]}return{inputs:n,weights:a,logit:o}}predict(t,e={},i={}){t=this._getModelInputsWeightsAndLogit(t,e,i);return this._sigmoid(t.logit)}fit(t){for(const a of t=Array.isArray(t)?t:[t])if(void 0!==a[this.targetLabel]){var e=this._getModelInputsWeightsAndLogit(a.actionId,null!=(i=a.context)?i:{},null!=(i=a.features)?i:{}),i=a[this.targetLabel];if(1<i||i<0)throw new Error("Target label must be between 0 and 1! But got `${this.targetLabel}`=`${y}`");let t=1;this.useInversePropensityWeighting&&(t=1/a.probability);var r=this._sigmoid(e.logit),n=t*this.learningRate*(r-i);for(const o in e.inputs)this.weights[o]=e.weights[o]-n*e.inputs[o]}}}i.SimpleOracle=r},{}],5:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&("get"in n?e.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,n)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(t("./interfaces"),i),n(t("./SimpleOracle"),i),n(t("./SimpleBandit"),i)},{"./SimpleBandit":3,"./SimpleOracle":4,"./interfaces":12}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],7:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],8:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],9:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],10:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],11:[function(t,e,i){arguments[4][6][0].apply(i,arguments)},{dup:6}],12:[function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&("get"in n?e.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,r,n)}:function(t,e,i,r){t[r=void 0===r?i:r]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(t("./IAction"),i),n(t("./IRecommendation"),i),n(t("./ISimpleBandit"),i),n(t("./ISimpleOracle"),i),n(t("./IState"),i),n(t("./ITrainingData"),i)},{"./IAction":6,"./IRecommendation":7,"./ISimpleBandit":8,"./ISimpleOracle":9,"./IState":10,"./ITrainingData":11}]},{},[1]);